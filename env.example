# ═════════════════════════════════════════════════════════════════════════════
# CORE CONFIGURATION
# ═════════════════════════════════════════════════════════════════════════════

# MongoDB connection (REQUIRED)
MONGODB_URI=mongodb+srv://<user>:<password>@<cluster-url>/?retryWrites=true&w=majority
# Local development alternative:
# MONGODB_URI=mongodb://localhost:27017

# MongoDB database name
MONGODB_DB=mongo_hack
DB_NAME=mongo_hack

# API Keys (REQUIRED for LLM operations)
OPENAI_API_KEY=sk-openai-xxxx                         # Required for chat agents and LLM stages
VOYAGE_API_KEY=sk-voyage-xxxx                         # Required for embeddings
YOUTUBE_API_KEY=yt-xxxx                               # Optional for video metadata

# Environment
GRAPHRAG_ENVIRONMENT=development                      # Options: development, staging, production


# ═════════════════════════════════════════════════════════════════════════════
# CHAT SYSTEM (used by chat.py agents)
# ═════════════════════════════════════════════════════════════════════════════

OPENAI_DEFAULT_MODEL=gpt-4o-mini                      # Recommended: gpt-4o-mini for reliability
                                                      # All agents (PlannerAgent, ReferenceAnswerAgent, TopicReferenceAgent) use this


# ═════════════════════════════════════════════════════════════════════════════
# EMBEDDINGS (Voyage AI)
# ═════════════════════════════════════════════════════════════════════════════

VOYAGE_EMBED_MODEL=voyage-2
VOYAGE_MAX_RETRIES=4
VOYAGE_TIMEOUT=60
VOYAGE_BACKOFF_BASE=1.5
VOYAGE_RPM=20
VOYAGE_JITTER_MS=250


# ═════════════════════════════════════════════════════════════════════════════
# RAG WEIGHTS (used in app/services/rag.py)
# ═════════════════════════════════════════════════════════════════════════════

RAG_WEIGHT_VECTOR=0.6
RAG_WEIGHT_TRUST=0.25
RAG_WEIGHT_RECENCY=0.15


# ═════════════════════════════════════════════════════════════════════════════
# CLEAN STAGE
# ═════════════════════════════════════════════════════════════════════════════

# Toggle LLM path: set to 1 to enable
CLEAN_WITH_LLM=0
# Re-upsert existing cleaned docs (default false)
CLEAN_UPSERT_EXISTING=false
# Concurrency for LLM cleaning
CLEAN_CONCURRENCY=4


# ═════════════════════════════════════════════════════════════════════════════
# ENRICH STAGE
# ═════════════════════════════════════════════════════════════════════════════

ENRICH_WITH_LLM=0
ENRICH_UPSERT_EXISTING=false
# Optional enforcement of tag/keyphrase count caps
ENRICH_ENFORCE_COUNTS=false
# Concurrency for LLM enrichment
ENRICH_CONCURRENCY=8


# ═════════════════════════════════════════════════════════════════════════════
# CHUNK+EMBED STAGE
# ═════════════════════════════════════════════════════════════════════════════

CHUNK_WITH_LLM=0
CHUNK_UPSERT_EXISTING=false
# Concurrency knob for future LLM chunking
CHUNK_CONCURRENCY=4
EMBEDDER=voyage
VECTOR_DIM=1024


# ═════════════════════════════════════════════════════════════════════════════
# REDUNDANCY STAGE
# ═════════════════════════════════════════════════════════════════════════════

DEDUP_WITH_LLM=0
DEDUP_UPSERT_EXISTING=false
DEDUP_THRESHOLD=0.92
DEDUP_LLM_MARGIN=0.03
DEDUP_LLM_TOPK=1
DEDUP_SKIP_ADJACENT=true
DEDUP_NONADJ_FALLBACK=true
DEDUP_ADJ_OVERRIDE=0.975


# ═════════════════════════════════════════════════════════════════════════════
# TRUST STAGE
# ═════════════════════════════════════════════════════════════════════════════

TRUST_WITH_LLM=0
TRUST_UPSERT_EXISTING=false
TRUST_LLM_AUTO=true
TRUST_LLM_BAND_LOW=0.40
TRUST_LLM_BAND_HIGH=0.70
TRUST_LLM_NEIGHBORS=2


# ═════════════════════════════════════════════════════════════════════════════
# RETRIEVAL/UI
# ═════════════════════════════════════════════════════════════════════════════

TOP_K=8
LLM_STREAMING=false


# ═════════════════════════════════════════════════════════════════════════════
# GENERIC LLM SETTINGS
# ═════════════════════════════════════════════════════════════════════════════

# Shared retry/backoff settings (used by shared concurrency helper)
LLM_RETRIES=1
LLM_BACKOFF_S=0.5


# ═════════════════════════════════════════════════════════════════════════════
# SESSION/FEEDBACK (UI)
# ═════════════════════════════════════════════════════════════════════════════

SESSION_ID=


# ═════════════════════════════════════════════════════════════════════════════
# OBSERVABILITY & GRAPHRAG PIPELINE
# ═════════════════════════════════════════════════════════════════════════════

# Pipeline Control
GRAPHRAG_ENABLED=true                                 # Enable/disable GraphRAG pipeline
EXPERIMENT_ID=                                        # Optional: tracking for experiments

# Pipeline Processing
GRAPHRAG_ENABLE_INCREMENTAL=true                      # Enable incremental processing
GRAPHRAG_MAX_PROCESSING_TIME=7200                     # Maximum time for processing (seconds)
GRAPHRAG_CHECKPOINT_INTERVAL=100                      # Save checkpoint every N items
GRAPHRAG_MAX_RETRIES=3                                # Maximum retry attempts
GRAPHRAG_RETRY_DELAY=5.0                              # Delay between retries (seconds)
GRAPHRAG_CONTINUE_ON_ERROR=true                       # Continue pipeline on errors

# Logging
GRAPHRAG_LOG_LEVEL=INFO                               # Options: DEBUG, INFO, WARNING, ERROR
GRAPHRAG_LOG_FILE=                                    # Optional: log file path

# LLM Model Selection
GRAPHRAG_MODEL=gpt-4o-mini                            # Primary LLM model
OPENAI_MODEL=                                         # Fallback LLM model (if needed)

# LLM Settings
GRAPHRAG_TEMPERATURE=0.1                              # LLM temperature (0.0-1.0)
GRAPHRAG_MAX_TOKENS=                                  # Max tokens per response
GRAPHRAG_LLM_RETRIES=3                                # LLM-specific retry attempts
GRAPHRAG_LLM_BACKOFF_S=1.0                            # LLM retry backoff (seconds)

# ───────────────────────────────────────────────────────────────────────────
# EXTRACTION STAGE
# ───────────────────────────────────────────────────────────────────────────

GRAPHRAG_EXTRACTION_CONCURRENCY=300                   # Parallel extraction tasks (dev: 5-10, prod: 300)
GRAPHRAG_MAX_ENTITIES_PER_CHUNK=20                    # Maximum entities extracted per chunk
GRAPHRAG_MAX_RELATIONSHIPS_PER_CHUNK=30               # Maximum relationships per chunk
GRAPHRAG_MIN_ENTITY_CONFIDENCE=0.3                    # Minimum confidence for entities (0.0-1.0)
GRAPHRAG_MIN_RELATIONSHIP_CONFIDENCE=0.3              # Minimum confidence for relationships (0.0-1.0)
GRAPHRAG_BATCH_SIZE=50                                # Batch size for extraction (dev: 25, prod: 50-200)
GRAPHRAG_EXTRACTION_TIMEOUT=30                        # Timeout per extraction (seconds)

# ───────────────────────────────────────────────────────────────────────────
# ENTITY RESOLUTION STAGE
# ───────────────────────────────────────────────────────────────────────────

GRAPHRAG_RESOLUTION_CONCURRENCY=300                   # Parallel resolution tasks (dev: 5-8, prod: 300)
GRAPHRAG_ENTITY_RESOLUTION_THRESHOLD=0.85             # Similarity threshold for merging (0.0-1.0)
GRAPHRAG_MAX_ALIASES_PER_ENTITY=10                    # Maximum aliases per entity
GRAPHRAG_MIN_SOURCE_COUNT=1                           # Minimum sources before merging
GRAPHRAG_RESOLUTION_BATCH_SIZE=100                    # Batch size for resolution
GRAPHRAG_RESOLUTION_TIMEOUT=60                        # Timeout per resolution (seconds)
GRAPHRAG_USE_FUZZY_MATCHING=true                      # Enable fuzzy string matching
GRAPHRAG_USE_EMBEDDING_SIMILARITY=true                # Use embeddings for similarity
GRAPHRAG_USE_CONTEXT_SIMILARITY=true                  # Use context matching
GRAPHRAG_USE_RELATIONSHIP_CLUSTERING=true             # Use relationship clustering

# ───────────────────────────────────────────────────────────────────────────
# GRAPH CONSTRUCTION STAGE
# ───────────────────────────────────────────────────────────────────────────

GRAPHRAG_CONSTRUCTION_BATCH_SIZE=200                  # Batch size for construction
GRAPHRAG_MAX_RELATIONSHIPS_PER_ENTITY=100             # Maximum relationships per entity
GRAPHRAG_CALCULATE_CENTRALITY=true                    # Calculate centrality metrics
GRAPHRAG_CALCULATE_DEGREE=true                        # Calculate degree metrics
GRAPHRAG_CALCULATE_CLUSTERING=false                   # Calculate clustering coefficient
GRAPHRAG_VALIDATE_ENTITY_EXISTENCE=true               # Validate entity references
GRAPHRAG_MAX_RELATIONSHIP_DISTANCE=3                  # Maximum relationship distance

# ───────────────────────────────────────────────────────────────────────────
# COMMUNITY DETECTION STAGE
# ───────────────────────────────────────────────────────────────────────────

GRAPHRAG_COMMUNITY_TEMPERATURE=0.2                    # Temperature for community detection
GRAPHRAG_COMMUNITY_ALGORITHM=louvain                  # Algorithm: louvain, leiden
GRAPHRAG_MAX_CLUSTER_SIZE=50                          # Maximum cluster size
GRAPHRAG_MIN_CLUSTER_SIZE=2                           # Minimum cluster size
GRAPHRAG_RESOLUTION_PARAMETER=1.0                     # Resolution parameter (0.5-2.0)
GRAPHRAG_MAX_ITERATIONS=100                           # Maximum iterations
GRAPHRAG_MAX_LEVELS=3                                 # Maximum hierarchy levels
GRAPHRAG_LEVEL_SIZE_THRESHOLD=5                       # Level size threshold
GRAPHRAG_MAX_SUMMARY_LENGTH=2000                      # Maximum summary length (chars)
GRAPHRAG_MIN_SUMMARY_LENGTH=100                       # Minimum summary length (chars)
GRAPHRAG_SUMMARIZATION_TIMEOUT=120                    # Timeout for summarization (seconds)
GRAPHRAG_MIN_COHERENCE_SCORE=0.6                      # Minimum coherence score (0.0-1.0)
GRAPHRAG_MIN_ENTITY_COUNT=2                           # Minimum entities in community
GRAPHRAG_COMMUNITY_CONCURRENCY=300                    # Parallel community tasks (dev: 5, prod: 300)


# ═════════════════════════════════════════════════════════════════════════════
# OBSERVABILITY & MONITORING (Docker Compose Stack)
# ═════════════════════════════════════════════════════════════════════════════

# Prometheus
PROMETHEUS_PORT=9090                                  # Prometheus UI port
PROMETHEUS_CONFIG_PATH=./observability/prometheus/prometheus.yml
PROMETHEUS_DATA_PATH=./prometheus-data

# Grafana
GRAFANA_PORT=3000                                     # Grafana UI port
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin
GRAFANA_DATA_PATH=./grafana-data

# Loki
LOKI_PORT=3100                                        # Loki API port
LOKI_CONFIG_PATH=./observability/loki/loki-config.yml
LOKI_DATA_PATH=./loki-data

# Promtail
PROMTAIL_CONFIG_PATH=./observability/promtail/promtail-config.yml
PROMTAIL_LOG_PATH=./logs

# Metrics Server (Application)
METRICS_SERVER_PORT=9091                              # Metrics endpoint port
METRICS_SCRAPE_INTERVAL=15s                           # How often Prometheus scrapes
METRICS_SCRAPE_TIMEOUT=10s                            # Timeout for scrape request


# ═════════════════════════════════════════════════════════════════════════════
# NOTES
# ═════════════════════════════════════════════════════════════════════════════

# 1. REQUIRED VARIABLES (must be set):
#    - MONGODB_URI
#    - OPENAI_API_KEY (for LLM operations)
#    - VOYAGE_API_KEY (for embeddings)
#
# 2. OPTIONAL VARIABLES (have sensible defaults):
#    - All other variables can be omitted and will use their defaults
#
# 3. DEVELOPMENT vs PRODUCTION:
#    - Development: Use lower concurrency (5-10), batch_size (25-50), LOG_LEVEL=DEBUG
#    - Production: Use higher concurrency (300), batch_size (50-200), LOG_LEVEL=WARNING
#
# 4. OBSERVABILITY:
#    - GraphRAG collects metrics automatically and exports to Prometheus endpoint (port 9091)
#    - Start metrics server: python app/api/metrics.py 9091
#    - Verify: curl http://localhost:9091/metrics
#
# 5. DOCKER COMPOSE STACK:
#    - Start: docker-compose -f docker-compose.observability.yml up -d
#    - Stop: docker-compose -f docker-compose.observability.yml down
#    - View logs: docker-compose -f docker-compose.observability.yml logs -f
#
# 6. FULL DOCUMENTATION:
#    - All variables: documentation/Environment-Variables-Guide.md
#    - Template: documentation/ENV-OBSERVABILITY-TEMPLATE.md
#    - Achievement 1.2: observability/10-EXECUTOR-GUIDE-ACHIEVEMENT-1.2.md
